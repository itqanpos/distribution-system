/**
 * ูุธุงู ุชูุงูู ุงูุฏููู ูุงูููุฏูุจูู - ุดุฑูุฉ ุงูุชูุฒูุน ุงูุบุฐุงุฆู
 * ุงูุฅุตุฏุงุฑ: 1.0.0
 * ุงูุชุงุฑูุฎ: 2024-01-16
 * ุงููุธููุฉ: ุฑุจุท ูุธุงู ุงูุฏููู ุจูุธุงู ุงูููุฏูุจูู ุจุดูู ูุชูุงูู
 */

// ุงุณุชูุฑุงุฏ ุงูุฃูุธูุฉ
const ูุธุงููุชุงุจุนุฉุงูุฏููู = require('../ุงูุฏููู/ูุธุงู-ุงูุฏููู.js');
const ูุธุงูุฅุฏุงุฑุฉุงูููุฏูุจูู = require('../ุงูููุฏูุจูู/ูุธุงู-ุงูููุฏูุจูู.js');

class ูุธุงูุชูุงููุงูุฏููููุงูููุฏูุจูู {
    constructor() {
        // ุฅูุดุงุก ูุซููุงุช ูู ุงูุฃูุธูุฉ
        this.ูุธุงูุงูุฏููู = new ูุธุงููุชุงุจุนุฉุงูุฏููู();
        this.ูุธุงูุงูููุฏูุจูู = new ูุธุงูุฅุฏุงุฑุฉุงูููุฏูุจูู();
        
        // ุฑุจุท ุงูุนููุงุก ุจุงูููุฏูุจูู
        this.ุฑุจุทุงูุนููุงุกุจุงูููุฏูุจูู();
        
        console.log('๐ ุชููุฆุฉ ูุธุงู ุงูุชูุงูู ุจูู ุงูุฏููู ูุงูููุฏูุจูู...');
        console.log(`โ ุชู ุฑุจุท ${this.ูุธุงูุงูุฏููู.ุงูุนููุงุก.length} ุนููู ูุน ${this.ูุธุงูุงูููุฏูุจูู.ุงูููุฏูุจูู.length} ููุฏูุจ`);
    }

    // 1. ุฑุจุท ุงูุนููุงุก ุจุงูููุฏูุจูู ุชููุงุฆูุงู
    ุฑุจุทุงูุนููุงุกุจุงูููุฏูุจูู() {
        console.log('๐ ุฑุจุท ุงูุนููุงุก ุจุงูููุฏูุจูู...');
        
        // ููู ุนูููุ ูุนูู ูู ููุฏูุจุงู ุญุณุจ ููุทูุชู
        this.ูุธุงูุงูุฏููู.ุงูุนููุงุก.forEach(ุนููู => {
            // ุฅุฐุง ูู ููู ููุนููู ููุฏูุจ ูุณุฌู
            if (!ุนููู.ุฑููุงูููุฏูุจ) {
                // ูุฌุฏ ุงูููุฏูุจ ุงูููุงุณุจ ุญุณุจ ุงูููุทูุฉ
                const ุงูููุฏูุจุงูููุงุณุจ = this.ุฅูุฌุงุฏููุฏูุจุจุงูููุทูุฉ(ุนููู.ุงูุนููุงู);
                
                if (ุงูููุฏูุจุงูููุงุณุจ) {
                    ุนููู.ุฑููุงูููุฏูุจ = ุงูููุฏูุจุงูููุงุณุจ.ุงูุฑูู;
                    ุนููู.ุงุณูุงูููุฏูุจ = ุงูููุฏูุจุงูููุงุณุจ.ุงูุงุณู;
                    console.log(`   ุชู ุฑุจุท ุงูุนููู ${ุนููู.ุงูุงุณู} ูุน ุงูููุฏูุจ ${ุงูููุฏูุจุงูููุงุณุจ.ุงูุงุณู}`);
                } else {
                    // ุฅุฐุง ูู ูุฌุฏ ููุฏูุจุงู ููุงุณุจุงูุ ูุนุทู ุงูุนููู ููููุฏูุจ ุงูุฃูู
                    ุนููู.ุฑููุงูููุฏูุจ = this.ูุธุงูุงูููุฏูุจูู.ุงูููุฏูุจูู[0].ุงูุฑูู;
                    ุนููู.ุงุณูุงูููุฏูุจ = this.ูุธุงูุงูููุฏูุจูู.ุงูููุฏูุจูู[0].ุงูุงุณู;
                    console.log(`   ุชู ุฑุจุท ุงูุนููู ${ุนููู.ุงูุงุณู} ูุน ุงูููุฏูุจ ุงูุงูุชุฑุงุถู`);
                }
            }
        });
    }

    // 2. ุฅูุฌุงุฏ ููุฏูุจ ุญุณุจ ุงูููุทูุฉ
    ุฅูุฌุงุฏููุฏูุจุจุงูููุทูุฉ(ููุทูุฉุงูุนููู) {
        // ููุณู ุงูููุงุทู ุฅูู ููุงุทู ุฑุฆูุณูุฉ
        const ุงูููุงุทู = {
            "ุงูุดุฑููุฉ": ["ุงูููุทูุฉ ุงูุดุฑููุฉ", "ุญู ุงูุดุฑู", "ุดุฑู ุงููุฏููุฉ"],
            "ุงูุบุฑุจูุฉ": ["ุงูููุทูุฉ ุงูุบุฑุจูุฉ", "ุญู ุงูุบุฑุจ", "ุบุฑุจ ุงููุฏููุฉ"],
            "ุงูุดูุงููุฉ": ["ุญู ุงูุดูุงู", "ุดูุงู ุงููุฏููุฉ"],
            "ุงูุฌููุจูุฉ": ["ุญู ุงูุฌููุจ", "ุฌููุจ ุงููุฏููุฉ"]
        };

        // ูุฌุฏ ุงูููุชุงุญ ุงูููุงุณุจ ูููุทูุฉ ุงูุนููู
        let ููุทูุฉููุชุงุญ = "";
        for (const [ููุชุงุญ, ููุงุทู] of Object.entries(ุงูููุงุทู)) {
            if (ููุงุทู.some(ููุทูุฉ => ููุทูุฉุงูุนููู.includes(ููุทูุฉ))) {
                ููุทูุฉููุชุงุญ = ููุชุงุญ;
                break;
            }
        }

        // ุฅุฐุง ูู ูุฌุฏ ููุทูุฉ ูุญุฏุฏุฉุ ูุนูุฏ ุงูููุฏูุจ ุงูุฃูู
        if (!ููุทูุฉููุชุงุญ) {
            return this.ูุธุงูุงูููุฏูุจูู.ุงูููุฏูุจูู[0];
        }

        // ูุจุญุซ ุนู ุงูููุฏูุจ ุงูููุงุณุจ ููููุทูุฉ
        const ููุฏูุจููุงุณุจ = this.ูุธุงูุงูููุฏูุจูู.ุงูููุฏูุจูู.find(ููุฏูุจ => {
            return ููุฏูุจ.ุงูููุทูุฉ.includes(ููุทูุฉููุชุงุญ);
        });

        return ููุฏูุจููุงุณุจ || this.ูุธุงูุงูููุฏูุจูู.ุงูููุฏูุจูู[0];
    }

    // 3. ุชุณุฌูู ุชุญุตูู ุฏูู ุจูุงุณุทุฉ ุงูููุฏูุจ (ุงููุธููุฉ ุงูุฑุฆูุณูุฉ)
    ุชุณุฌููุชุญุตููููุฏูุจ(ุฑููุงูููุฏูุจ, ุฑููุงูุนููู, ุงููุจูุบ, ุทุฑููุฉุงูุฏูุน = "ููุฏู", ููุงุญุธุงุช = "") {
        console.log(`๐ฐ ุงูููุฏูุจ ${ุฑููุงูููุฏูุจ} ูุญุตู ุฏููุงู ูู ุงูุนููู ${ุฑููุงูุนููู}`);
        
        // 1. ุงูุชุญูู ูู ุฃู ุงูููุฏูุจ ูุณุคูู ุนู ูุฐุง ุงูุนููู
        const ุงูุนููู = this.ูุธุงูุงูุฏููู.ุงูุนููุงุก.find(ุน => ุน.ุงูุฑูู === ุฑููุงูุนููู);
        if (!ุงูุนููู) {
            throw new Error(`ุงูุนููู ุฑูู ${ุฑููุงูุนููู} ุบูุฑ ููุฌูุฏ`);
        }

        if (ุงูุนููู.ุฑููุงูููุฏูุจ !== ุฑููุงูููุฏูุจ) {
            console.warn(`โ๏ธ  ุชุญุฐูุฑ: ุงูููุฏูุจ ${ุฑููุงูููุฏูุจ} ููุณ ูุณุคููุงู ุนู ุงูุนููู ${ุฑููุงูุนููู}`);
            console.warn(`   ุงูุนููู ูุณุคูู ุนูู ุงูููุฏูุจ: ${ุงูุนููู.ุฑููุงูููุฏูุจ}`);
            // ูููููุง ุงูุณูุงุญ ุจุงูุชุญุตูู ูุน ุชูุจูู ุฃู ุฑูุถู
        }

        // 2. ุชุณุฌูู ุงูุชุญุตูู ูู ูุธุงู ุงูุฏููู
        const ุชุญุตููุงูุฏููู = this.ูุธุงูุงูุฏููู.ุชุณุฌููุชุญุตูู(ุฑููุงูุนููู, ุงููุจูุบ, ุทุฑููุฉุงูุฏูุน, ููุงุญุธุงุช);
        
        // 3. ุชุณุฌูู ุงูุชุญุตูู ูู ูุธุงู ุงูููุฏูุจูู
        this.ูุธุงูุงูููุฏูุจูู.ุชุณุฌููุฒูุงุฑุฉ(ุฑููุงูููุฏูุจ, {
            ุงูุนููู: ุงูุนููู.ุงูุงุณู,
            ุงููุจูุนุงุช: 0, // ุชุญุตูู ููุท ุจุฏูู ูุจูุนุงุช ุฌุฏูุฏุฉ
            ุงูุชุญุตูู: ุงููุจูุบ,
            ุงูููุงุญุธุงุช: `ุชุญุตูู ุฏูู - ${ููุงุญุธุงุช}`
        });

        // 4. ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงูููุฏูุจ
        this.ูุธุงูุงูููุฏูุจูู.ุชุญุฏูุซุฅุญุตุงุฆูุงุชุงูููุฏูุจ(ุฑููุงูููุฏูุจ, {
            ุชุญุตููุงุช: ุงููุจูุบ
        });

        // 5. ุฅุถุงูุฉ ุณุฌู ูู ูุธุงู ุงูููุฏูุจูู ููุชุญุตูู
        this.ูุธุงูุงูููุฏูุจูู.ุชุณุฌูููุตุฑููุงุช(ุฑููุงูููุฏูุจ, "ุชุญุตูู", ุงููุจูุบ, `ุชุญุตูู ูู ุงูุนููู ${ุงูุนููู.ุงูุงุณู}`);

        console.log(`โ ุชู ุชุณุฌูู ุชุญุตูู ${ุงููุจูุบ} ุจูุงุณุทุฉ ุงูููุฏูุจ ${ุฑููุงูููุฏูุจ}`);
        return ุชุญุตููุงูุฏููู;
    }

    // 4. ุชุณุฌูู ุจูุน ุฌุฏูุฏ ุจูุงุณุทุฉ ุงูููุฏูุจ
    ุชุณุฌููุจูุนููุฏูุจ(ุฑููุงูููุฏูุจ, ุฑููุงูุนููู, ูุงุฆูุฉุงูููุชุฌุงุช, ุงููุจูุบุงูุฅุฌูุงูู, ุฏูุนุฉููุฏูุฉ = 0) {
        console.log(`๐ ุงูููุฏูุจ ${ุฑููุงูููุฏูุจ} ูุณุฌู ุจูุนุงู ููุนููู ${ุฑููุงูุนููู}`);
        
        const ุงูุนููู = this.ูุธุงูุงูุฏููู.ุงูุนููุงุก.find(ุน => ุน.ุงูุฑูู === ุฑููุงูุนููู);
        if (!ุงูุนููู) {
            throw new Error(`ุงูุนููู ุฑูู ${ุฑููุงูุนููู} ุบูุฑ ููุฌูุฏ`);
        }

        // 1. ุฅุถุงูุฉ ุฏูู ุฌุฏูุฏ ูู ูุธุงู ุงูุฏููู
        const ุฏููุฌุฏูุฏ = this.ูุธุงูุงูุฏููู.ุฅุถุงูุฉุฏูู({
            ุฑููุงูุนููู: ุฑููุงูุนููู,
            ุงููุจูุบ: ุงููุจูุบุงูุฅุฌูุงูู - ุฏูุนุฉููุฏูุฉ,
            ุงููุตู: `ุจูุน ุจูุงุณุทุฉ ุงูููุฏูุจ ${ุฑููุงูููุฏูุจ}`
        });

        // 2. ุชุณุฌูู ุงูุชุญุตูู ุงูููุฏู ุฅู ูุฌุฏ
        if (ุฏูุนุฉููุฏูุฉ > 0) {
            this.ุชุณุฌููุชุญุตููููุฏูุจ(ุฑููุงูููุฏูุจ, ุฑููุงูุนููู, ุฏูุนุฉููุฏูุฉ, "ููุฏู", "ุฏูุนุฉ ููุฏูุฉ ุนูู ุงูุจูุน");
        }

        // 3. ุชุณุฌูู ุงูุจูุน ูู ูุธุงู ุงูููุฏูุจูู
        this.ูุธุงูุงูููุฏูุจูู.ุชุณุฌููุฒูุงุฑุฉ(ุฑููุงูููุฏูุจ, {
            ุงูุนููู: ุงูุนููู.ุงูุงุณู,
            ุงููุจูุนุงุช: ุงููุจูุบุงูุฅุฌูุงูู,
            ุงูุชุญุตูู: ุฏูุนุฉููุฏูุฉ,
            ุงูููุงุญุธุงุช: `ุจูุน ${ูุงุฆูุฉุงูููุชุฌุงุช.length} ููุชุฌ`
        });

        // 4. ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงูููุฏูุจ
        this.ูุธุงูุงูููุฏูุจูู.ุชุญุฏูุซุฅุญุตุงุฆูุงุชุงูููุฏูุจ(ุฑููุงูููุฏูุจ, {
            ูุจูุนุงุช: ุงููุจูุบุงูุฅุฌูุงูู,
            ุชุญุตููุงุช: ุฏูุนุฉููุฏูุฉ
        });

        console.log(`โ ุชู ุชุณุฌูู ุจูุน ุจูููุฉ ${ุงููุจูุบุงูุฅุฌูุงูู} ุจูุงุณุทุฉ ุงูููุฏูุจ ${ุฑููุงูููุฏูุจ}`);
        return ุฏููุฌุฏูุฏ;
    }

    // 5. ุนุฑุถ ุฏููู ุนููุงุก ุงูููุฏูุจ
    ุนุฑุถุฏูููุนููุงุกุงูููุฏูุจ(ุฑููุงูููุฏูุจ) {
        const ุนููุงุกุงูููุฏูุจ = this.ูุธุงูุงูุฏููู.ุงูุนููุงุก.filter(ุนููู => ุนููู.ุฑููุงูููุฏูุจ === ุฑููุงูููุฏูุจ);
        
        const ุงูุฏูููุงูููุตูุฉ = ุนููุงุกุงูููุฏูุจ.map(ุนููู => {
            const ุฏูููุงูุนููู = this.ูุธุงูุงูุฏููู.ุงูุฏููู.filter(ุฏูู => 
                ุฏูู.ุฑููุงูุนููู === ุนููู.ุงูุฑูู && ุฏูู.ุงูุญุงูุฉ === "ุบูุฑ ูุณุฏุฏ"
            );

            return {
                ุงูุนููู: ุนููู.ุงูุงุณู,
                ุงููุงุชู: ุนููู.ุงููุงุชู,
                ุฅุฌูุงููุงูุฏูู: ุนููู.ุงูุฏููุงูุญุงูู,
                ุญุงูุฉุงูุฏูู: ุนููู.ุญุงูุฉุงูุฏูู,
                ุขุฎุฑุชุญุตูู: ุนููู.ุขุฎุฑุชุญุตูู,
                ุนุฏุฏุงูุฏููู: ุฏูููุงูุนููู.length,
                ุงูุฏูููุงูููุตูุฉ: ุฏูููุงูุนููู
            };
        });

        // ุญุณุงุจ ุงูุฅุฌูุงููุงุช
        const ุงูุฅุฌูุงููุงุช = {
            ุนุฏุฏุงูุนููุงุก: ุนููุงุกุงูููุฏูุจ.length,
            ุฅุฌูุงููุงูุฏููู: ุนููุงุกุงูููุฏูุจ.reduce((ูุฌููุน, ุนููู) => ูุฌููุน + ุนููู.ุงูุฏููุงูุญุงูู, 0),
            ุงูุฏูููุงููุชุฃุฎุฑุฉ: ุนููุงุกุงูููุฏูุจ
                .filter(ุนููู => ุนููู.ุญุงูุฉุงูุฏูู.includes("ูุชุฃุฎุฑ"))
                .reduce((ูุฌููุน, ุนููู) => ูุฌููุน + ุนููู.ุงูุฏููุงูุญุงูู, 0),
            ุนููุงุกูุชุฃุฎุฑูู: ุนููุงุกุงูููุฏูุจ.filter(ุนููู => ุนููู.ุญุงูุฉุงูุฏูู.includes("ูุชุฃุฎุฑ")).length
        };

        return {
            ุงูููุฏูุจ: this.ูุธุงูุงูููุฏูุจูู.ุงูููุฏูุจูู.find(ู => ู.ุงูุฑูู === ุฑููุงูููุฏูุจ).ุงูุงุณู,
            ุงูุชุงุฑูุฎ: new Date().toLocaleDateString('ar-EG'),
            ุงูุฏููู: ุงูุฏูููุงูููุตูุฉ,
            ุงูุฅุฌูุงููุงุช: ุงูุฅุฌูุงููุงุช
        };
    }

    // 6. ุชูุฑูุฑ ุชุญุตูู ุงูููุฏูุจูู
    ุชูุฑูุฑุชุญุตููุงูููุฏูุจูู(ูุชุฑุฉ = "ุงูููู") {
        console.log(`๐ ุฅูุดุงุก ุชูุฑูุฑ ุชุญุตูู ุงูููุฏูุจูู ูููุชุฑุฉ: ${ูุชุฑุฉ}`);
        
        const ุงูุชูุฑูุฑ = this.ูุธุงูุงูููุฏูุจูู.ุงูููุฏูุจูู.map(ููุฏูุจ => {
            // ุชุญุตููุงุช ุงูููุฏูุจ ุงูููููุฉ
            const ุชุญุตููุงุชุงูููู = this.ูุธุงูุงูุฏููู.ุงูุฏููู
                .filter(ุฏูู => 
                    ุฏูู.ููุนุงูุนูููุฉ === "ุชุญุตูู" &&
                    ุฏูู.ุงูุญุงูุฉ === "ูุณุฏุฏ" &&
                    ุฏูู.ุงูุชุงุฑูุฎ === new Date().toISOString().split('T')[0]
                )
                .filter(ุฏูู => {
                    const ุงูุนููู = this.ูุธุงูุงูุฏููู.ุงูุนููุงุก.find(ุน => ุน.ุงูุฑูู === ุฏูู.ุฑููุงูุนููู);
                    return ุงูุนููู && ุงูุนููู.ุฑููุงูููุฏูุจ === ููุฏูุจ.ุงูุฑูู;
                })
                .reduce((ูุฌููุน, ุฏูู) => ูุฌููุน + ุฏูู.ุงููุจูุบ, 0);

            // ุฏููู ุนููุงุก ุงูููุฏูุจ
            const ุนููุงุกุงูููุฏูุจ = this.ูุธุงูุงูุฏููู.ุงูุนููุงุก.filter(ุนููู => ุนููู.ุฑููุงูููุฏูุจ === ููุฏูุจ.ุงูุฑูู);
            const ุฅุฌูุงููุฏูููู = ุนููุงุกุงูููุฏูุจ.reduce((ูุฌููุน, ุนููู) => ูุฌููุน + ุนููู.ุงูุฏููุงูุญุงูู, 0);
            const ุฏููููุชุฃุฎุฑุฉ = ุนููุงุกุงูููุฏูุจ
                .filter(ุนููู => ุนููู.ุญุงูุฉุงูุฏูู.includes("ูุชุฃุฎุฑ"))
                .reduce((ูุฌููุน, ุนููู) => ูุฌููุน + ุนููู.ุงูุฏููุงูุญุงูู, 0);

            return {
                ุงูููุฏูุจ: ููุฏูุจ.ุงูุงุณู,
                ุงูููุทูุฉ: ููุฏูุจ.ุงูููุทูุฉ,
                ุชุญุตููุงูููู: ุชุญุตููุงุชุงูููู,
                ูุจูุนุงุชุงูููู: ููุฏูุจ.ุงููุจูุนุงุชุงูููู,
                ุฅุฌูุงููุฏูููู: ุฅุฌูุงููุฏูููู,
                ุฏููููุชุฃุฎุฑุฉ: ุฏููููุชุฃุฎุฑุฉ,
                ูุณุจุฉุงูุชุญุตูู: ุฅุฌูุงููุฏูููู > 0 ? ((ุฅุฌูุงููุฏูููู - ุฏููููุชุฃุฎุฑุฉ) / ุฅุฌูุงููุฏูููู * 100).toFixed(2) : 0,
                ุนุฏุฏุนููุงุกู: ุนููุงุกุงูููุฏูุจ.length
            };
        });

        // ุชุฑุชูุจ ุญุณุจ ุงูุชุญุตูู (ุชูุงุฒูู)
        return ุงูุชูุฑูุฑ.sort((ุฃ, ุจ) => ุจ.ุชุญุตููุงูููู - ุฃ.ุชุญุตููุงูููู);
    }

    // 7. ุชูุฒูุน ุงูุนููุงุก ุงูุฌุฏุฏ ุนูู ุงูููุฏูุจูู
    ุชูุฒูุนุนููุงุกุฌุฏุฏ(ูุงุฆูุฉุงูุนููุงุกุงูุฌุฏุฏ) {
        console.log(`๐ค ุชูุฒูุน ${ูุงุฆูุฉุงูุนููุงุกุงูุฌุฏุฏ.length} ุนููู ุฌุฏูุฏ ุนูู ุงูููุฏูุจูู`);
        
        const ุงูุนููุงุกุจุนุฏุงูุชูุฒูุน = ูุงุฆูุฉุงูุนููุงุกุงูุฌุฏุฏ.map(ุนููู => {
            // ุฅูุฌุงุฏ ุงูููุฏูุจ ุงูุฃูุณุจ ุญุณุจ ููุทูุชู ูุชูุฒูุน ุงูุญูู
            const ุงูููุฏูุจุงูุฃูุณุจ = this.ุฅูุฌุงุฏุงูููุฏูุจุงูุฃูุณุจ(ุนููู.ุงูุนููุงู);
            
            return {
                ...ุนููู,
                ุฑููุงูููุฏูุจ: ุงูููุฏูุจุงูุฃูุณุจ.ุงูุฑูู,
                ุงุณูุงูููุฏูุจ: ุงูููุฏูุจุงูุฃูุณุจ.ุงูุงุณู,
                ุชุงุฑูุฎุงูุชูุฒูุน: new Date().toISOString().split('T')[0]
            };
        });

        // ุฅุถุงูุฉ ุงูุนููุงุก ููุธุงู ุงูุฏููู
        ุงูุนููุงุกุจุนุฏุงูุชูุฒูุน.forEach(ุนููู => {
            this.ูุธุงูุงูุฏููู.ุงูุนููุงุก.push(ุนููู);
        });

        console.log(`โ ุชู ุชูุฒูุน ุงูุนููุงุก ุงูุฌุฏุฏ ุจูุฌุงุญ`);
        return ุงูุนููุงุกุจุนุฏุงูุชูุฒูุน;
    }

    // 8. ุฅูุฌุงุฏ ุงูููุฏูุจ ุงูุฃูุณุจ ููุชูุฒูุน ุงูุนุงุฏู
    ุฅูุฌุงุฏุงูููุฏูุจุงูุฃูุณุจ(ููุทูุฉุงูุนููู) {
        // ูุฌุฏ ุฌููุน ุงูููุฏูุจูู
        const ุงูููุฏูุจูู = this.ูุธุงูุงูููุฏูุจูู.ุงูููุฏูุจูู;
        
        // ูุญุณุจ ุนุฏุฏ ุงูุนููุงุก ููู ููุฏูุจ
        const ุนููุงุกููููุฏูุจ = {};
        this.ูุธุงูุงูุฏููู.ุงูุนููุงุก.forEach(ุนููู => {
            if (ุนููู.ุฑููุงูููุฏูุจ) {
                ุนููุงุกููููุฏูุจ[ุนููู.ุฑููุงูููุฏูุจ] = (ุนููุงุกููููุฏูุจ[ุนููู.ุฑููุงูููุฏูุจ] || 0) + 1;
            }
        });

        // ูุฌุฏ ุงูููุฏูุจูู ุงูููุงุณุจูู ููููุทูุฉ
        const ุงูููุฏูุจููุงูููุงุณุจูู = ุงูููุฏูุจูู.filter(ููุฏูุจ => {
            return ููุฏูุจ.ุงูููุทูุฉ.includes(this.ุชุญุฏูุฏุงูููุชุงุญุงูููุทูู(ููุทูุฉุงูุนููู));
        });

        // ุฅุฐุง ูุฌุฏูุง ููุฏูุจูู ููุงุณุจูู ููููุทูุฉ
        if (ุงูููุฏูุจููุงูููุงุณุจูู.length > 0) {
            // ูุฃุฎุฐ ุงูููุฏูุจ ุงูุฐู ูุฏูู ุฃูู ุนุฏุฏ ูู ุงูุนููุงุก
            return ุงูููุฏูุจููุงูููุงุณุจูู.reduce((ุฃูู, ููุฏูุจ) => {
                const ุนููุงุกุงูููุฏูุจ = ุนููุงุกููููุฏูุจ[ููุฏูุจ.ุงูุฑูู] || 0;
                const ุนููุงุกุงูุฃูู = ุนููุงุกููููุฏูุจ[ุฃูู.ุงูุฑูู] || 0;
                return ุนููุงุกุงูููุฏูุจ < ุนููุงุกุงูุฃูู ? ููุฏูุจ : ุฃูู;
            });
        }

        // ุฅุฐุง ูู ูุฌุฏ ููุฏูุจุงู ููุงุณุจุงู ููููุทูุฉุ ูุฃุฎุฐ ุงูููุฏูุจ ุงูุฐู ูุฏูู ุฃูู ุนุฏุฏ ุนููุงุก
        return ุงูููุฏูุจูู.reduce((ุฃูู, ููุฏูุจ) => {
            const ุนููุงุกุงูููุฏูุจ = ุนููุงุกููููุฏูุจ[ููุฏูุจ.ุงูุฑูู] || 0;
            const ุนููุงุกุงูุฃูู = ุนููุงุกููููุฏูุจ[ุฃูู.ุงูุฑูู] || 0;
            return ุนููุงุกุงูููุฏูุจ < ุนููุงุกุงูุฃูู ? ููุฏูุจ : ุฃูู;
        });
    }

    // 9. ุชุญุฏูุฏ ุงูููุชุงุญ ุงูููุทูู ูู ุงูุนููุงู
    ุชุญุฏูุฏุงูููุชุงุญุงูููุทูู(ุงูุนููุงู) {
        if (ุงูุนููุงู.includes("ุดุฑู") || ุงูุนููุงู.includes("ุงูุดุฑููุฉ")) return "ุงูุดุฑููุฉ";
        if (ุงูุนููุงู.includes("ุบุฑุจ") || ุงูุนููุงู.includes("ุงูุบุฑุจูุฉ")) return "ุงูุบุฑุจูุฉ";
        if (ุงูุนููุงู.includes("ุดูุงู")) return "ุงูุดูุงููุฉ";
        if (ุงูุนููุงู.includes("ุฌููุจ")) return "ุงูุฌููุจูุฉ";
        return "ุงููุณุทู";
    }

    // 10. ุชูุฑูุฑ ุงูููุงูุณุฉ ุจูู ุงูููุฏูุจูู
    ุชูุฑูุฑุงูููุงูุณุฉุจููุงูููุฏูุจูู() {
        const ุงูุชูุฑูุฑ = this.ูุธุงูุงูููุฏูุจูู.ุงูููุฏูุจูู.map(ููุฏูุจ => {
            const ุนููุงุกู = this.ูุธุงูุงูุฏููู.ุงูุนููุงุก.filter(ุนููู => ุนููู.ุฑููุงูููุฏูุจ === ููุฏูุจ.ุงูุฑูู);
            
            const ุฏูููุนููุงุกู = ุนููุงุกู.reduce((ูุฌููุน, ุนููู) => ูุฌููุน + ุนููู.ุงูุฏููุงูุญุงูู, 0);
            const ุชุญุตููุงุชู = this.ูุธุงูุงูุฏููู.ุงูุฏููู
                .filter(ุฏูู => ุฏูู.ููุนุงูุนูููุฉ === "ุชุญุตูู" && ุฏูู.ุงูุญุงูุฉ === "ูุณุฏุฏ")
                .filter(ุฏูู => {
                    const ุงูุนููู = this.ูุธุงูุงูุฏููู.ุงูุนููุงุก.find(ุน => ุน.ุงูุฑูู === ุฏูู.ุฑููุงูุนููู);
                    return ุงูุนููู && ุงูุนููู.ุฑููุงูููุฏูุจ === ููุฏูุจ.ุงูุฑูู;
                })
                .reduce((ูุฌููุน, ุฏูู) => ูุฌููุน + ุฏูู.ุงููุจูุบ, 0);

            const ุงูููุงุท = (ููุฏูุจ.ุงููุจูุนุงุชุงูููู * 0.5) + (ุชุญุตููุงุชู * 1.5) - (ุฏูููุนููุงุกู * 0.1);

            return {
                ุงูุชุฑุชูุจ: 0, // ุณูุชู ุญุณุงุจู ูุงุญูุงู
                ุงูููุฏูุจ: ููุฏูุจ.ุงูุงุณู,
                ุงูููุทูุฉ: ููุฏูุจ.ุงูููุทูุฉ,
                ุงููุจูุนุงุชุงูููู: ููุฏูุจ.ุงููุจูุนุงุชุงูููู,
                ุงูุชุญุตููุงูููู: ุชุญุตููุงุชู,
                ุฏูููุนููุงุกู: ุฏูููุนููุงุกู,
                ุนุฏุฏุนููุงุกู: ุนููุงุกู.length,
                ุงูููุงุท: Math.round(ุงูููุงุท)
            };
        });

        // ุชุฑุชูุจ ุญุณุจ ุงูููุงุท (ุชูุงุฒูู)
        const ูุฑุชุจ = ุงูุชูุฑูุฑ.sort((ุฃ, ุจ) => ุจ.ุงูููุงุท - ุฃ.ุงูููุงุท);
        
        // ุฅุถุงูุฉ ุงูุชุฑุชูุจ
        ูุฑุชุจ.forEach((ููุฏูุจ, index) => {
            ููุฏูุจ.ุงูุชุฑุชูุจ = index + 1;
            ููุฏูุจ.ุงูุฌุงุฆุฒุฉ = this.ุชุญุฏูุฏุงูุฌุงุฆุฒุฉ(index + 1);
        });

        return ูุฑุชุจ;
    }

    // 11. ุชุญุฏูุฏ ุงูุฌุงุฆุฒุฉ ุญุณุจ ุงูุชุฑุชูุจ
    ุชุญุฏูุฏุงูุฌุงุฆุฒุฉ(ุงูุชุฑุชูุจ) {
        switch(ุงูุชุฑุชูุจ) {
            case 1: return "๐ ุจุทู ุงูุชุญุตูู";
            case 2: return "๐ฅ ุงููุฑูุฒ ุงูุซุงูู";
            case 3: return "๐ฅ ุงููุฑูุฒ ุงูุซุงูุซ";
            default: return "๐ ุฌูุฏ";
        }
    }

    // 12. ุฅุดุนุงุฑุงุช ุงูููุฏูุจูู ุนู ุงูุฏููู ุงููุชุฃุฎุฑุฉ
    ุฅุดุนุงุฑุงุชููููุฏูุจููุจุงููุชุฃุฎุฑุงุช() {
        const ุงูุฅุดุนุงุฑุงุช = [];
        
        this.ูุธุงูุงูููุฏูุจูู.ุงูููุฏูุจูู.forEach(ููุฏูุจ => {
            const ุนููุงุกุงููุชุฃุฎุฑูู = this.ูุธุงูุงูุฏููู.ุงูุนููุงุก
                .filter(ุนููู => 
                    ุนููู.ุฑููุงูููุฏูุจ === ููุฏูุจ.ุงูุฑูู && 
                    ุนููู.ุญุงูุฉุงูุฏูู.includes("ูุชุฃุฎุฑ")
                );

            if (ุนููุงุกุงููุชุฃุฎุฑูู.length > 0) {
                const ุฅุฌูุงููุงููุชุฃุฎุฑุงุช = ุนููุงุกุงููุชุฃุฎุฑูู.reduce((ูุฌููุน, ุนููู) => ูุฌููุน + ุนููู.ุงูุฏููุงูุญุงูู, 0);
                
                ุงูุฅุดุนุงุฑุงุช.push({
                    ุงูููุฏูุจ: ููุฏูุจ.ุงูุงุณู,
                    ุนุฏุฏุงูุนููุงุกุงููุชุฃุฎุฑูู: ุนููุงุกุงููุชุฃุฎุฑูู.length,
                    ุฅุฌูุงููุงููุชุฃุฎุฑุงุช: ุฅุฌูุงููุงููุชุฃุฎุฑุงุช,
                    ุงูุนููุงุก: ุนููุงุกุงููุชุฃุฎุฑูู.map(ุนููู => ({
                        ุงูุงุณู: ุนููู.ุงูุงุณู,
                        ุงูุฏูู: ุนููู.ุงูุฏููุงูุญุงูู,
                        ุงููุงุชู: ุนููู.ุงููุงุชู
                    })),
                    ุงูุฑุณุงูุฉ: `ูุฏูู ${ุนููุงุกุงููุชุฃุฎุฑูู.length} ุนููู ูุชุฃุฎุฑ ุจูุจูุบ ุฅุฌูุงูู ${ุฅุฌูุงููุงููุชุฃุฎุฑุงุช} ุฌ`
                });
            }
        });

        return ุงูุฅุดุนุงุฑุงุช;
    }

    // 13. ุชุตุฏูุฑ ุชูุฑูุฑ ุงูุชูุงูู ุงููุงูู
    ุชุตุฏูุฑุชูุฑูุฑุงูุชูุงูู() {
        const ุงูุชูุฑูุฑ = {
            ุงูุชุงุฑูุฎ: new Date().toLocaleString('ar-EG'),
            ููุฎุตุงููุธุงู: {
                ุนุฏุฏุงูุนููุงุก: this.ูุธุงูุงูุฏููู.ุงูุนููุงุก.length,
                ุนุฏุฏุงูููุฏูุจูู: this.ูุธุงูุงูููุฏูุจูู.ุงูููุฏูุจูู.length,
                ุฅุฌูุงููุงูุฏููู: this.ูุธุงูุงูุฏููู.ุชูุฑูุฑุฅุฌูุงููุงูุฏููู().ุฅุฌูุงููุงูุฏููู,
                ุงููุจูุนุงุชุงูููู: this.ูุธุงูุงูููุฏูุจูู.ุงูููุฏูุจูู.reduce((ูุฌููุน, ู) => ูุฌููุน + ู.ุงููุจูุนุงุชุงูููู, 0),
                ุงูุชุญุตููุงูููู: this.ูุธุงูุงูููุฏูุจูู.ุงูููุฏูุจูู.reduce((ูุฌููุน, ู) => ูุฌููุน + ู.ุงูุชุญุตููุงุชุงูููู, 0)
            },
            ุชูุฑูุฑุงูููุงูุณุฉ: this.ุชูุฑูุฑุงูููุงูุณุฉุจููุงูููุฏูุจูู(),
            ุชุญุตููุงูููุฏูุจูู: this.ุชูุฑูุฑุชุญุตููุงูููุฏูุจูู(),
            ุฅุดุนุงุฑุงุชุงููุชุฃุฎุฑุงุช: this.ุฅุดุนุงุฑุงุชููููุฏูุจููุจุงููุชุฃุฎุฑุงุช(),
            ุงูููุฏูุจุงูุฃูุถู: this.ุชูุฑูุฑุงูููุงูุณุฉุจููุงูููุฏูุจูู()[0]
        };

        return JSON.stringify(ุงูุชูุฑูุฑ, null, 2);
    }

    // 14. ุงุฎุชุจุงุฑ ูุธุงู ุงูุชูุงูู
    ุงุฎุชุจุงุฑุงููุธุงู() {
        console.log('๐งช ุจุฏุก ุงุฎุชุจุงุฑ ูุธุงู ุงูุชูุงูู ุจูู ุงูุฏููู ูุงูููุฏูุจูู\n');

        // 1. ุนุฑุถ ูุนูููุงุช ุงูุชูุงูู
        console.log('๐ ูุนูููุงุช ุงูุชูุงูู:');
        console.log(`   ุนุฏุฏ ุงูุนููุงุก: ${this.ูุธุงูุงูุฏููู.ุงูุนููุงุก.length}`);
        console.log(`   ุนุฏุฏ ุงูููุฏูุจูู: ${this.ูุธุงูุงูููุฏูุจูู.ุงูููุฏูุจูู.length}`);
        
        // 2. ุนุฑุถ ุฏููู ูู ููุฏูุจ
        console.log('\n๐ฅ ุฏููู ุนููุงุก ูู ููุฏูุจ:');
        this.ูุธุงูุงูููุฏูุจูู.ุงูููุฏูุจูู.forEach(ููุฏูุจ => {
            const ุฏูููุงูููุฏูุจ = this.ุนุฑุถุฏูููุนููุงุกุงูููุฏูุจ(ููุฏูุจ.ุงูุฑูู);
            console.log(`   ${ููุฏูุจ.ุงูุงุณู}: ${ุฏูููุงูููุฏูุจ.ุงูุฅุฌูุงููุงุช.ุฅุฌูุงููุงูุฏููู} ุฌ (${ุฏูููุงูููุฏูุจ.ุงูุฅุฌูุงููุงุช.ุนุฏุฏุงูุนููุงุก} ุนููู)`);
        });

        // 3. ุชุณุฌูู ุชุญุตูู ุจูุงุณุทุฉ ููุฏูุจ
        console.log('\n๐ฐ ุงุฎุชุจุงุฑ ุชุญุตูู ุจูุงุณุทุฉ ููุฏูุจ:');
        try {
            const ุชุญุตูู = this.ุชุณุฌููุชุญุตููููุฏูุจ(1, 1, 5000, "ููุฏู", "ุชุญุตูู ุชุฌุฑูุจู");
            console.log(`   โ ุชู ุงูุชุญุตูู ุจูุฌุงุญ: ${ุชุญุตูู.ุงููุจูุบ} ุฌ`);
        } catch (ุฎุทุฃ) {
            console.log(`   โ ุฎุทุฃ: ${ุฎุทุฃ.message}`);
        }

        // 4. ุชุณุฌูู ุจูุน ุจูุงุณุทุฉ ููุฏูุจ
        console.log('\n๐ ุงุฎุชุจุงุฑ ุจูุน ุจูุงุณุทุฉ ููุฏูุจ:');
        try {
            const ุจูุน = this.ุชุณุฌููุจูุนููุฏูุจ(2, 2, ["ุฃุฑุฒ", "ุณูุฑ"], 10000, 3000);
            console.log(`   โ ุชู ุงูุจูุน ุจูุฌุงุญ: ${ุจูุน.ุงููุจูุบ} ุฌ`);
        } catch (ุฎุทุฃ) {
            console.log(`   โ ุฎุทุฃ: ${ุฎุทุฃ.message}`);
        }

        // 5. ุชูุฑูุฑ ุงูููุงูุณุฉ
        console.log('\n๐ ุชูุฑูุฑ ุงูููุงูุณุฉ ุจูู ุงูููุฏูุจูู:');
        const ุงูููุงูุณุฉ = this.ุชูุฑูุฑุงูููุงูุณุฉุจููุงูููุฏูุจูู();
        ุงูููุงูุณุฉ.forEach(ููุฏูุจ => {
            console.log(`   ${ููุฏูุจ.ุงูุชุฑุชูุจ}. ${ููุฏูุจ.ุงูููุฏูุจ}: ${ููุฏูุจ.ุงูููุงุท} ููุทุฉ (${ููุฏูุจ.ุงูุฌุงุฆุฒุฉ})`);
        });

        // 6. ุฅุดุนุงุฑุงุช ุงููุชุฃุฎุฑุงุช
        console.log('\nโ๏ธ  ุฅุดุนุงุฑุงุช ุงูุฏููู ุงููุชุฃุฎุฑุฉ:');
        const ุงูุฅุดุนุงุฑุงุช = this.ุฅุดุนุงุฑุงุชููููุฏูุจููุจุงููุชุฃุฎุฑุงุช();
        if (ุงูุฅุดุนุงุฑุงุช.length > 0) {
            ุงูุฅุดุนุงุฑุงุช.forEach(ุฅุดุนุงุฑ => {
                console.log(`   ${ุฅุดุนุงุฑ.ุงูููุฏูุจ}: ${ุฅุดุนุงุฑ.ุงูุฑุณุงูุฉ}`);
            });
        } else {
            console.log('   ๐ ูุง ุชูุฌุฏ ุฏููู ูุชุฃุฎุฑุฉ!');
        }

        // 7. ุชุตุฏูุฑ ุงูุชูุฑูุฑ ุงููุงูู
        console.log('\n๐ ุงูุชูุฑูุฑ ุงููุงูู ููุชูุงูู:');
        const ุงูุชูุฑูุฑุงููุงูู = this.ุชุตุฏูุฑุชูุฑูุฑุงูุชูุงูู();
        console.log(ุงูุชูุฑูุฑุงููุงูู);

        console.log('\nโ ุชู ุงูุงูุชูุงุก ูู ุงุฎุชุจุงุฑ ูุธุงู ุงูุชูุงูู ุจูุฌุงุญ!');
        return true;
    }
}

// ุชุตุฏูุฑ ุงููุธุงู ููุงุณุชุฎุฏุงู
if (typeof module !== 'undefined' && module.exports) {
    module.exports = ูุธุงูุชูุงููุงูุฏููููุงูููุฏูุจูู;
}

// ุฅุฐุง ูุงู ุงูุชุญููู ูู ุงููุชุตูุญ
if (typeof window !== 'undefined') {
    window.ูุธุงูุชูุงููุงูุฏููููุงูููุฏูุจูู = ูุธุงูุชูุงููุงูุฏููููุงูููุฏูุจูู;
}

// ุชุดุบูู ุงูุงุฎุชุจุงุฑ ุงูุชููุงุฆู ุฅุฐุง ูุงู ุงูููู ุงูุฑุฆูุณู
if (require.main === module) {
    const ุงููุธุงู = new ูุธุงูุชูุงููุงูุฏููููุงูููุฏูุจูู();
    ุงููุธุงู.ุงุฎุชุจุงุฑุงููุธุงู();
}
