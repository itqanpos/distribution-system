/**
 * ูุธุงู ูุชุงุจุนุฉ ุฏููู ุงูุนููุงุก
 * ุงูุฅุตุฏุงุฑ: 1.0.0
 * ุงูุชุงุฑูุฎ: 2024-01-16
 */

class ูุธุงููุชุงุจุนุฉุงูุฏููู {
    constructor() {
        this.ุงูุฏููู = [];
        this.ุงูุนููุงุก = [];
        this.ุงูุชูุจููุงุงุช = [];
        this.ุชููุฆุฉุงูุจูุงูุงุช();
    }

    // ุชููุฆุฉ ุงูุจูุงูุงุช ุงูุฃูููุฉ
    ุชููุฆุฉุงูุจูุงูุงุช() {
        console.log('๐ ุชููุฆุฉ ูุธุงู ูุชุงุจุนุฉ ุงูุฏููู...');
        
        // ุจูุงูุงุช ุชุฌุฑูุจูุฉ ููุนููุงุก
        this.ุงูุนููุงุก = [
            {
                ุงูุฑูู: 1,
                ุงูุงุณู: "ูุญูุฏ ุฃุญูุฏ",
                ุงููุงุชู: "01012345678",
                ุงูุนููุงู: "ุงูููุทูุฉ ุงูุดุฑููุฉ",
                ุญุฏุงูุงุฆุชูุงู: 50000,
                ุงูุฏููุงูุญุงูู: 25000,
                ุขุฎุฑุชุญุตูู: "2024-01-10",
                ุญุงูุฉุงูุฏูู: "ูุชุฃุฎุฑ"
            },
            {
                ุงูุฑูู: 2,
                ุงูุงุณู: "ุณูุจุฑูุงุฑูุช ุงูููุฑ",
                ุงููุงุชู: "01087654321",
                ุงูุนููุงู: "ุงูููุทูุฉ ุงูุบุฑุจูุฉ",
                ุญุฏุงูุงุฆุชูุงู: 100000,
                ุงูุฏููุงูุญุงูู: 15000,
                ุขุฎุฑุชุญุตูู: "2024-01-15",
                ุญุงูุฉุงูุฏูู: "ุฌูุฏ"
            },
            {
                ุงูุฑูู: 3,
                ุงูุงุณู: "ูุทุนู ุงูุดูู",
                ุงููุงุชู: "01055556666",
                ุงูุนููุงู: "ูุณุท ุงูุจูุฏ",
                ุญุฏุงูุงุฆุชูุงู: 30000,
                ุงูุฏููุงูุญุงูู: 30000,
                ุขุฎุฑุชุญุตูู: "2023-12-20",
                ุญุงูุฉุงูุฏูู: "ุญุฑุฌ"
            }
        ];

        // ุณุฌู ุงูุฏููู
        this.ุงูุฏููู = [
            {
                ุฑููุงูุนูููุฉ: 1,
                ุฑููุงูุนููู: 1,
                ุงููุจูุบ: 15000,
                ุงูุชุงุฑูุฎ: "2024-01-05",
                ููุนุงูุนูููุฉ: "ุจูุน",
                ุงูุญุงูุฉ: "ุบูุฑ ูุณุฏุฏ",
                ูุชุฑุฉุงูุชุฃุฎูุฑ: 11
            },
            {
                ุฑููุงูุนูููุฉ: 2,
                ุฑููุงูุนููู: 2,
                ุงููุจูุบ: 5000,
                ุงูุชุงุฑูุฎ: "2024-01-10",
                ููุนุงูุนูููุฉ: "ุชุญุตูู",
                ุงูุญุงูุฉ: "ูุณุฏุฏ",
                ูุชุฑุฉุงูุชุฃุฎูุฑ: 0
            }
        ];

        console.log('โ ุชู ุชููุฆุฉ ุจูุงูุงุช ' + this.ุงูุนููุงุก.length + ' ุนููู');
    }

    // 1. ุฅุถุงูุฉ ุฏูู ุฌุฏูุฏ
    ุฅุถุงูุฉุฏูู(ุจูุงูุงุชุงูุฏูู) {
        const ุฏููุฌุฏูุฏ = {
            ุฑููุงูุนูููุฉ: this.ุงูุฏููู.length + 1,
            ...ุจูุงูุงุชุงูุฏูู,
            ุงูุชุงุฑูุฎ: new Date().toISOString().split('T')[0],
            ุงูุญุงูุฉ: "ุบูุฑ ูุณุฏุฏ",
            ูุชุฑุฉุงูุชุฃุฎูุฑ: 0
        };

        this.ุงูุฏููู.push(ุฏููุฌุฏูุฏ);
        
        // ุชุญุฏูุซ ุฏูู ุงูุนููู
        this.ุชุญุฏูุซุฏููุงูุนููู(ุจูุงูุงุชุงูุฏูู.ุฑููุงูุนููู, ุจูุงูุงุชุงูุฏูู.ุงููุจูุบ);

        console.log('โ ุชู ุฅุถุงูุฉ ุฏูู ุฌุฏูุฏ ููุนููู ุฑูู ' + ุจูุงูุงุชุงูุฏูู.ุฑููุงูุนููู);
        return ุฏููุฌุฏูุฏ;
    }

    // 2. ุชุญุฏูุซ ุฏูู ุงูุนููู
    ุชุญุฏูุซุฏููุงูุนููู(ุฑููุงูุนููู, ุงููุจูุบ) {
        const ุงูุนููู = this.ุงูุนููุงุก.find(ุน => ุน.ุงูุฑูู === ุฑููุงูุนููู);
        if (ุงูุนููู) {
            ุงูุนููู.ุงูุฏููุงูุญุงูู += ุงููุจูุบ;
            
            // ุชุญุฏูุซ ุญุงูุฉ ุงูุฏูู
            if (ุงูุนููู.ุงูุฏููุงูุญุงูู >= ุงูุนููู.ุญุฏุงูุงุฆุชูุงู) {
                ุงูุนููู.ุญุงูุฉุงูุฏูู = "ููุชูู";
            } else if (ุงูุนููู.ุงูุฏููุงูุญุงูู > (ุงูุนููู.ุญุฏุงูุงุฆุชูุงู * 0.7)) {
                ุงูุนููู.ุญุงูุฉุงูุฏูู = "ุญุฑุฌ";
            } else if (ุงูุนููู.ุงูุฏููุงูุญุงูู > (ุงูุนููู.ุญุฏุงูุงุฆุชูุงู * 0.3)) {
                ุงูุนููู.ุญุงูุฉุงูุฏูู = "ูุชูุณุท";
            } else {
                ุงูุนููู.ุญุงูุฉุงูุฏูู = "ุฌูุฏ";
            }

            console.log('๐ ุชู ุชุญุฏูุซ ุฏูู ุงูุนููู ' + ุงูุนููู.ุงูุงุณู + ' ุฅูู ' + ุงูุนููู.ุงูุฏููุงูุญุงูู);
        }
    }

    // 3. ุชุณุฌูู ุชุญุตูู
    ุชุณุฌููุชุญุตูู(ุฑููุงูุนููู, ุงููุจูุบุงููุญุตู, ุทุฑููุฉุงูุฏูุน = "ููุฏู", ููุงุญุธุงุช = "") {
        const ุงูุชุญุตูู = {
            ุฑููุงูุนูููุฉ: this.ุงูุฏููู.length + 1,
            ุฑููุงูุนููู: ุฑููุงูุนููู,
            ุงููุจูุบ: ุงููุจูุบุงููุญุตู,
            ุงูุชุงุฑูุฎ: new Date().toISOString().split('T')[0],
            ููุนุงูุนูููุฉ: "ุชุญุตูู",
            ุทุฑููุฉุงูุฏูุน: ุทุฑููุฉุงูุฏูุน,
            ููุงุญุธุงุช: ููุงุญุธุงุช,
            ุงูุญุงูุฉ: "ูุณุฏุฏ"
        };

        this.ุงูุฏููู.push(ุงูุชุญุตูู);
        
        // ุชุญุฏูุซ ุฏูู ุงูุนููู (ุชุฎููุถ)
        const ุงูุนููู = this.ุงูุนููุงุก.find(ุน => ุน.ุงูุฑูู === ุฑููุงูุนููู);
        if (ุงูุนููู) {
            ุงูุนููู.ุงูุฏููุงูุญุงูู -= ุงููุจูุบุงููุญุตู;
            ุงูุนููู.ุขุฎุฑุชุญุตูู = new Date().toISOString().split('T')[0];
            
            // ุชุญุฏูุซ ุญุงูุฉ ุงูุฏูู ุจุนุฏ ุงูุชุญุตูู
            this.ุชุญุฏูุซุญุงูุฉุงูุฏูู(ุงูุนููู);
        }

        console.log('๐ฐ ุชู ุชุณุฌูู ุชุญุตูู ' + ุงููุจูุบุงููุญุตู + ' ูู ุงูุนููู ุฑูู ' + ุฑููุงูุนููู);
        return ุงูุชุญุตูู;
    }

    // 4. ุชุญุฏูุซ ุญุงูุฉ ุงูุฏูู
    ุชุญุฏูุซุญุงูุฉุงูุฏูู(ุงูุนููู) {
        const ุงูููู = new Date();
        const ุขุฎุฑุชุญุตูู = new Date(ุงูุนููู.ุขุฎุฑุชุญุตูู);
        const ุงููุฑูุจุงูุฃูุงู = Math.floor((ุงูููู - ุขุฎุฑุชุญุตูู) / (1000 * 60 * 60 * 24));

        if (ุงููุฑูุจุงูุฃูุงู > 30) {
            ุงูุนููู.ุญุงูุฉุงูุฏูู = "ูุชุฃุฎุฑ ุฌุฏุงู";
            this.ุฅุถุงูุฉุชูุจูู(ุงูุนููู.ุงูุฑูู, "ุชุฃุฎูุฑ ุฃูุซุฑ ูู 30 ููู");
        } else if (ุงููุฑูุจุงูุฃูุงู > 15) {
            ุงูุนููู.ุญุงูุฉุงูุฏูู = "ูุชุฃุฎุฑ";
            this.ุฅุถุงูุฉุชูุจูู(ุงูุนููู.ุงูุฑูู, "ุชุฃุฎูุฑ ุฃูุซุฑ ูู 15 ููู");
        } else if (ุงููุฑูุจุงูุฃูุงู > 7) {
            ุงูุนููู.ุญุงูุฉุงูุฏูู = "ูุชุฃุฎุฑ ููููุงู";
        }

        console.log('๐ ุญุงูุฉ ุฏูู ุงูุนููู ' + ุงูุนููู.ุงูุงุณู + ': ' + ุงูุนููู.ุญุงูุฉุงูุฏูู);
    }

    // 5. ุฅุถุงูุฉ ุชูุจูู
    ุฅุถุงูุฉุชูุจูู(ุฑููุงูุนููู, ุงูุฑุณุงูุฉ) {
        const ุงูุชูุจูู = {
            ุงูุฑูู: this.ุงูุชูุจููุงุงุช.length + 1,
            ุฑููุงูุนููู: ุฑููุงูุนููู,
            ุงูุฑุณุงูุฉ: ุงูุฑุณุงูุฉ,
            ุงูุชุงุฑูุฎ: new Date().toLocaleString('ar-EG'),
            ููุฑูุก: false
        };

        this.ุงูุชูุจููุงุงุช.push(ุงูุชูุจูู);
        console.log('โ๏ธ  ุชูุจูู ุฌุฏูุฏ: ' + ุงูุฑุณุงูุฉ);
    }

    // 6. ุชูุฑูุฑ ุฅุฌูุงูู ุงูุฏููู
    ุชูุฑูุฑุฅุฌูุงููุงูุฏููู() {
        let ุฅุฌูุงููุงูุฏููู = 0;
        let ุงูุฏูููุงููุชุฃุฎุฑุฉ = 0;
        let ุนุฏุฏุงูุนููุงุกุงููุฏูููู = 0;

        this.ุงูุนููุงุก.forEach(ุงูุนููู => {
            if (ุงูุนููู.ุงูุฏููุงูุญุงูู > 0) {
                ุฅุฌูุงููุงูุฏููู += ุงูุนููู.ุงูุฏููุงูุญุงูู;
                ุนุฏุฏุงูุนููุงุกุงููุฏูููู++;

                if (ุงูุนููู.ุญุงูุฉุงูุฏูู.includes("ูุชุฃุฎุฑ")) {
                    ุงูุฏูููุงููุชุฃุฎุฑุฉ += ุงูุนููู.ุงูุฏููุงูุญุงูู;
                }
            }
        });

        return {
            ุฅุฌูุงููุงูุฏููู: ุฅุฌูุงููุงูุฏููู,
            ุงูุฏูููุงููุชุฃุฎุฑุฉ: ุงูุฏูููุงููุชุฃุฎุฑุฉ,
            ุนุฏุฏุงูุนููุงุกุงููุฏูููู: ุนุฏุฏุงูุนููุงุกุงููุฏูููู,
            ูุณุจุฉุงูุชุญุตูู: ((ุฅุฌูุงููุงูุฏููู - ุงูุฏูููุงููุชุฃุฎุฑุฉ) / ุฅุฌูุงููุงูุฏููู * 100).toFixed(2)
        };
    }

    // 7. ูุงุฆูุฉ ุงูุนููุงุก ุงูุฃูุซุฑ ูุฏููููุฉ
    ุงูุนููุงุกุงูุฃูุซุฑูุฏููููุฉ(ุงูุนุฏุฏ = 10) {
        return this.ุงูุนููุงุก
            .filter(ุน => ุน.ุงูุฏููุงูุญุงูู > 0)
            .sort((ุฃ, ุจ) => ุจ.ุงูุฏููุงูุญุงูู - ุฃ.ุงูุฏููุงูุญุงูู)
            .slice(0, ุงูุนุฏุฏ)
            .map(ุนููู => ({
                ุงูุงุณู: ุนููู.ุงูุงุณู,
                ุงูุฏูู: ุนููู.ุงูุฏููุงูุญุงูู,
                ุงูุญุงูุฉ: ุนููู.ุญุงูุฉุงูุฏูู,
                ุงููุงุชู: ุนููู.ุงููุงุชู
            }));
    }

    // 8. ุงูุจุญุซ ุนู ุนููู
    ุจุญุซุนูุนููู(ูููุฉุงูุจุญุซ) {
        return this.ุงูุนููุงุก.filter(ุนููู => 
            ุนููู.ุงูุงุณู.includes(ูููุฉุงูุจุญุซ) || 
            ุนููู.ุงููุงุชู.includes(ูููุฉุงูุจุญุซ) ||
            ุนููู.ุงูุฑูู.toString() === ูููุฉุงูุจุญุซ
        );
    }

    // 9. ุชุตุฏูุฑ ุชูุฑูุฑ ุงูุฏููู
    ุชุตุฏูุฑุชูุฑูุฑุงูุฏููู() {
        const ุงูุชูุฑูุฑ = {
            ุงูุชุงุฑูุฎ: new Date().toLocaleString('ar-EG'),
            ููุฎุต: this.ุชูุฑูุฑุฅุฌูุงููุงูุฏููู(),
            ุงูุนููุงุกุงููุฏูููู: this.ุงูุนููุงุก.filter(ุน => ุน.ุงูุฏููุงูุญุงูู > 0),
            ุงูุชูุจููุงุช: this.ุงูุชูุจููุงุงุช.filter(ุช => !ุช.ููุฑูุก)
        };

        return JSON.stringify(ุงูุชูุฑูุฑ, null, 2);
    }

    // 10. ุงุฎุชุจุงุฑ ุงููุธุงู
    ุงุฎุชุจุงุฑุงููุธุงู() {
        console.log('๐งช ุจุฏุก ุงุฎุชุจุงุฑ ูุธุงู ุงูุฏููู...');
        
        // ุงุฎุชุจุงุฑ ุฅุถุงูุฉ ุฏูู ุฌุฏูุฏ
        const ุฏููุฌุฏูุฏ = this.ุฅุถุงูุฉุฏูู({
            ุฑููุงูุนููู: 2,
            ุงููุจูุบ: 10000,
            ุงููุตู: "ูุงุชูุฑุฉ ุฑูู 456"
        });
        
        // ุงุฎุชุจุงุฑ ุงูุชุญุตูู
        const ุชุญุตูู = this.ุชุณุฌููุชุญุตูู(1, 5000, "ุชุญููู ุจููู", "ุชุญุตูู ุฌุฒุฆู");
        
        // ุนุฑุถ ุงูุชูุงุฑูุฑ
        const ุงูุชูุฑูุฑ = this.ุชูุฑูุฑุฅุฌูุงููุงูุฏููู();
        console.log('๐ ุชูุฑูุฑ ุงูุฏููู:', ุงูุชูุฑูุฑ);
        
        // ุนุฑุถ ุงูุนููุงุก ุงูุฃูุซุฑ ูุฏููููุฉ
        const ุงููุฏูููู = this.ุงูุนููุงุกุงูุฃูุซุฑูุฏููููุฉ(5);
        console.log('๐ ุงูุนููุงุก ุงูุฃูุซุฑ ูุฏููููุฉ:', ุงููุฏูููู);
        
        console.log('โ ุชู ุงุฎุชุจุงุฑ ุงููุธุงู ุจูุฌุงุญ');
        return true;
    }
}

// ุชุตุฏูุฑ ุงููุธุงู ููุงุณุชุฎุฏุงู
if (typeof module !== 'undefined' && module.exports) {
    module.exports = ูุธุงููุชุงุจุนุฉุงูุฏููู;
}

// ุฅุฐุง ูุงู ุงูุชุญููู ูู ุงููุชุตูุญ
if (typeof window !== 'undefined') {
    window.ูุธุงููุชุงุจุนุฉุงูุฏููู = ูุธุงููุชุงุจุนุฉุงูุฏููู;
}

// ุชุดุบูู ุงูุงุฎุชุจุงุฑ ุงูุชููุงุฆู ุฅุฐุง ูุงู ุงูููู ุงูุฑุฆูุณู
if (require.main === module) {
    const ุงููุธุงู = new ูุธุงููุชุงุจุนุฉุงูุฏููู();
    ุงููุธุงู.ุงุฎุชุจุงุฑุงููุธุงู();
}
